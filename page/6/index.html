<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>






  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.3"/>


    <meta name="description" content="Android | jianqiu's blog" />



  <meta name="keywords" content="Hexo,next" />





  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.3" />



<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    analytics: {
      google: ''
    },
    sidebar: 'post'
  };
</script>




  <title> Jianqiu's blog </title>
</head>

<body>
  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->

  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <div id="header" class="header">
      <div class="header-inner">
        <h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand">
      <span class="logo">
        <i class="icon-logo"></i>
      </span>
      <span class="site-title">Jianqiu's blog</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<div class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/">
            <i class="menu-item-icon icon-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives">
            <i class="menu-item-icon icon-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags">
            <i class="menu-item-icon icon-tags"></i> <br />
            标签
          </a>
        </li>
      
    </ul>
  

  
</div>


      </div>
    </div>

    <div id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content">
          
  <div id="posts" class="posts-expand">
    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/01/10/Android-Service-三/">
                Android Service (三)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015 Jan 10
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/10/Android-Service-三/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/10/Android-Service-三/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>在前面有关服务的<a href="http://niorgai.github.io/2015/01/06/Android-Service-%E4%B8%80/">第一篇</a>和<a href="http://niorgai.github.io/2015/01/08/Android-Service-%E4%BA%8C/">第二篇</a>中已经说明了怎么开启一个服务，但之前的描述都是指一个应用内的服务，这些服务不能被其他应用程序调用。</p>
<p>Android采用了远程过程调用(Remote Procedure Call,RPC)来使其他应用程序也可以访问本应用程序内的服务。与其他基于RPC的解决方案一样，Android使用接口定义语言(Interface Definition Language)来公开服务的接口，所以跨进程访问的服务便称为<strong>AIDL(Android Interface Definition Language)</strong>服务。</p>
<p>一般创建AIDL服务的步骤如下(以Ant构建的项目为例)：</p>
<ol>
<li>在项目的src文件夹下任意包中新建一个XX.aidl文件，文件内容为相应包名及接口定义。如果aidl文件内容正确，gen目录下回自动生成一个同名的Java接口文件(gradle构建的项目没有找到。。)。</li>
<li>建立一个Service类并实现aidl文件定义的Java接口。</li>
<li>在AndroidManiFest.xml文件中注册AIDL服务。</li>
</ol>
<p>下面用一个例子来介绍：</p>
<ol>
<li><p>新建一个ITest.aidl文件,接口只有一个getData方法。</p>
<pre><code><span class="keyword">package</span> qiu.test

<span class="class"><span class="keyword">interface</span> <span class="title">ITest</span></span>{
    <span class="function">String <span class="title">getData</span><span class="params">()</span></span>;
}
</code></pre></li>
<li><p>编写一个TestService类。</p>
<pre><code>public <span class="class"><span class="keyword">class</span> <span class="title">TestService</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Service</span>{</span>

    public <span class="class"><span class="keyword">class</span> <span class="title">TestServiceeImp</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">ITest</span>.<span class="title">Stub</span>{</span>

        <span class="annotation">@Override</span>
         public <span class="type">String</span> getData() <span class="keyword">throws</span> <span class="type">RemoteException</span>{
            <span class="keyword">return</span> <span class="string">"Here is data"</span>;
        }
    }

    <span class="annotation">@Override</span>
    public <span class="type">IBinder</span> onBind(<span class="type">Intent</span> intent) {
        <span class="keyword">return</span> <span class="keyword">new</span> <span class="type">TestServiceImp</span>();
    }
}
</code></pre><p> Stub为IBinder的子类，通过onBind方法返回TestServiceImp对象，客户端便可以获取Service对象。</p>
</li>
<li><p>在AndroidManiFest.xml文件中配置Service。</p>
<pre><code><span class="tag">&lt;<span class="title">service</span> <span class="attribute">android:name</span>=<span class="value">".TestService"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span>
        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"qiu.test.ITest"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span>
<span class="tag">&lt;/<span class="title">service</span>&gt;</span>
</code></pre><p> 其实qiu.test.ITest便是客户端用于访问AIDL服务的ID。</p>
</li>
</ol>
<hr>
<h3 id="以上就是服务端的代码，也可以理解为另一程序的Service代码。下面来编写客户端，或者说调用端的代码。">以上就是服务端的代码，也可以理解为另一程序的Service代码。下面来编写客户端，或者说调用端的代码。</h3><hr>
<p>首先需要将服务端自动生成的ITest.java文件连同包目录一起复制到src文件中。</p>
<p>接下来实现MainActivity类。</p>
<pre><code><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">Activity</span> </span>{

    <span class="annotation">@Override</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>{
        <span class="keyword">super</span>.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        <span class="comment">//获取的服务端Service对象，通过该对象可以调用任意共有方法</span>
        ITest service = <span class="keyword">null</span>;

        ServiceConnection connection = <span class="keyword">new</span> ServiceConnection() {
            <span class="annotation">@Override</span>
            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{
                <span class="comment">//初始化服务端Service对象</span>
                service = ITest.Stub.asInterface(service);
            }

            <span class="annotation">@Override</span>
            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>{

            }
        };

        <span class="comment">//绑定服务,使用隐式Intent</span>
        bindService(<span class="keyword">new</span> Intent(<span class="string">"qiu.test.ITest"</span>), connection, BIND_AUTO_CREATE);

        <span class="comment">//绑定后就可以调用ITest的任意方法，比如getData。</span>
        System.out.println(<span class="string">"Data is : "</span> + service.getData());

    }
}
</code></pre>
        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/01/10/Broadcast-Receiver使用/">
                Broadcast Receiver使用
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015 Jan 10
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/10/Broadcast-Receiver使用/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/10/Broadcast-Receiver使用/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>作为Android的四大组件之一，广播接收器可以接收系统广播同时进行自定义的动作。</p>
<h6 id="广播接收器必须从android-content-BroadcastReceiver继承，同时需要实现onReceive方法，原型为：">广播接收器必须从android.content.BroadcastReceiver继承，同时需要实现onReceive方法，原型为：</h6><pre><code><span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onReceive</span><span class="params">(Context context, Intent intent)</span></span>;
</code></pre><p>一些常见的广播动作：</p>
<ul>
<li>android.provider.Telephony.SMS_RECEIVED 接收短信</li>
</ul>
<p>权限为android.permission.RECEIVE_SMS</p>
<ul>
<li>android.intent.action.PHONE_STATE 捕捉来电</li>
</ul>
<p>权限为android.permission.READ_PHONE_STATE</p>
<ul>
<li>android.intent.action.NEW_OUTGOING_CALL 捕捉去电</li>
</ul>
<p>权限为android.permission.PEOCESS_OUTGOING_CALLS</p>
<ul>
<li>android.intent.action.BOOT_COMPLETED 开机完毕</li>
</ul>
<h6 id="注册广播方法：">注册广播方法：</h6><pre><code>registerReceiver<span class="list">(<span class="keyword">BroadcastReceiver</span> receiver,IntentFilter filter)</span><span class="comment">;</span>
</code></pre><h6 id="注销广播方法：">注销广播方法：</h6><pre><code>unregisterReceiver<span class="list">(<span class="keyword">BroadcastReceiver</span> receiver)</span><span class="comment">;</span>
</code></pre><h6 id="通过设置AndroidManifest-xml中不同receiver的android:priority属性可以设置不同广播接收器的优先值。">通过设置AndroidManifest.xml中不同receiver的android:priority属性可以设置不同广播接收器的优先值。</h6><h4 id="发送广播方法：">发送广播方法：</h4><ol>
<li><p>添加广播数据和category并发送广播：</p>
<pre><code>Intent broadcastIntent = new Intent<span class="params">(<span class="string">"mobile.android.mybroadcast"</span>)</span>;
broadcastIntent.addCategory<span class="params">(<span class="string">"mobile.android.mycategory"</span>)</span>;
broadcastIntent.putExtra<span class="params">(<span class="string">"data"</span>,<span class="string">"test"</span>)</span>;
sendBroadcast<span class="params">(broadcastIntent)</span>;
</code></pre></li>
<li><p>配置接收器的AndroidManifest.xml文件，注册接收器</p>
<pre><code><span class="tag">&lt;<span class="title">receiver</span> <span class="attribute">android:name</span>=<span class="value">".myReceiver"</span>&gt;</span>
    <span class="tag">&lt;<span class="title">intent-filter</span>&gt;</span>
        <span class="tag">&lt;<span class="title">action</span> <span class="attribute">android:name</span>=<span class="value">"mobile.android.myboardcast"</span>/&gt;</span>
        <span class="tag">&lt;<span class="title">category</span> <span class="attribute">android:name</span>=<span class="value">"mobile.android.mycategory"</span>/&gt;</span>
    <span class="tag">&lt;/<span class="title">intent-filter</span>&gt;</span>
<span class="tag">&lt;/<span class="title">receiver</span>&gt;</span>
</code></pre></li>
<li><p>在myReceiver中继承BroadcastReceiver并实现onReceive方法，通过intent.getStringExtra(“data”)即可获取数据。</p>
</li>
</ol>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/01/08/Android-Service-二/">
                Android Service (二)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015 Jan 8
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/08/Android-Service-二/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/08/Android-Service-二/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <h4 id="后台服务">后台服务</h4><p>在<a href="http://niorgai.github.io/2015/01/06/Android-Service-%E4%B8%80/">第一篇的Service介绍</a>中说到Service的启动是后台运行,其实这里的后台跟Thread完全没有关系，这里所说的Service后台只是表示它不依赖UI，但事实上他与所绑定的组件是在<strong>同一个进程中</strong>运行的！所以如果Service中执行了耗时操作，一样会提示ANR。</p>
<p>如果Service与Activity绑定，即使Activity被销毁，或者程序被kill，Service还是会继续运行。当程序重新运行或者Activity重新与Service绑定后，可以获取Service中Binder的实例并调用其任意的公有方法。</p>
<h6 id="如果希望在Service中执行耗时操作，只需要在Service中新建一个子线程，如下图：">如果希望在Service中执行耗时操作，只需要在Service中新建一个子线程，如下图：</h6><pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>{
    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {
        <span class="annotation">@Override</span>
        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{
            <span class="comment">// 开始执行后台任务</span>
        }
    }).start();
    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;
}
</code></pre><h6 id="IntentService:方便用于执行耗时操作的Service子类">IntentService:方便用于执行耗时操作的Service子类</h6><p>文档原文：This is a subclass of Service that uses a worker thread to handle all start requests, one at a time. This is the best option if you don’t require that your service handle multiple requests simultaneously. All you need to do is implement onHandleIntent(), which receives the intent for each start request so you can do the background work.</p>
<p>当Service不需要同时处理多个请求时，使用IntentService会很方便。IntentService会默认开启一个worker thread来处理startService的请求，因为已经默认开了一个thread了，所以可以在Service中直接处理耗时操作。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">myService</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">IntentService</span>{</span>

        <span class="annotation">@Override</span>
        <span class="keyword">protected</span> void onHandleIntent(<span class="type">Intent</span> intent) {

        }
    }
</code></pre><hr>
<h4 id="前台服务">前台服务</h4><p>Service的系统优先级是比较低的，当系统内存不足时可能回收后台运行的Service，如果希望自己的Servie不被回收，可以使用前台Service，同时前台Service也会显示在系统的状态栏，下拉可以看到相关状态。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Service</span>{</span>

        <span class="annotation">@Override</span>
        public void onCreate() {
            <span class="type">Notification</span> notification = <span class="keyword">new</span> <span class="type">Notification</span>(
                    <span class="type">R</span>.drawable.ic_launcher,<span class="string">"有通知"</span>,<span class="type">System</span>.currentTimeMillis());
            <span class="comment">//设置目标Intent</span>
            <span class="type">Intent</span> notifyIntent = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="keyword">this</span>,<span class="type">MainActivity</span>.<span class="keyword">class</span>);
            <span class="comment">//设置点击跳转Intent</span>
            <span class="type">PendingIntent</span> pendingIntent = <span class="type">PendingIntent</span>.getActivity(
                    <span class="keyword">this</span>,<span class="number">0</span>,notifyIntent,<span class="number">0</span>);
            notification.setLatestEventInfo(<span class="keyword">this</span>,<span class="string">"通知的标题"</span>,<span class="string">"通知的内容"</span>,pendingIntent);
            startForeground(<span class="number">0</span>,notification);
            <span class="comment">//</span>
            <span class="keyword">super</span>.onCreate();
        }
    }
</code></pre><p> 其实就是创建一个Notification,通过setLatestEventInfo方法设置内容，startForeground方法变将其变为一个前台Service。</p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/01/06/Android-Service-一/">
                Android Service (一)
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015 Jan 6
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/06/Android-Service-一/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/06/Android-Service-一/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>Service(服务)也是Android四大应用程序组件之一，Service都是通过android.app.Service类继承而来，在这里先介绍Service基础。</p>
<p>Service没有UI部分，而是一直在Android后台运行，通常用于音乐播放或下载功能。可以通过onBind方法绑定Service与Activity,也可以通过onStartCommand方法启动Service(onStart方法已经废弃)。</p>
<ul>
<li><strong>使用onStartCommand方法启动Service,在应用退出时不会销毁服务。除非程序自己销毁</strong></li>
<li><strong>使用onBind方法启动Service时，在绑定的组件销毁时也会销毁绑定的服务</strong></li>
</ul>
<p>Service的生命周期如下：</p>
<p><img src="http://7sbqys.com1.z0.glb.clouddn.com/live_of_service.png" alt=""></p>
<p>关于bindService的生命周期,这张图的解释也比较细致。</p>
<p><img src="http://7sbqys.com1.z0.glb.clouddn.com/bind_service.png" alt=""></p>
<p>下面来举个栗子：<strong>Service的名字为MyService</strong></p>
<ul>
<li><p>可以通过以下代码启动服务。</p>
<pre><code>Intent serviceIntent = <span class="keyword">new</span> Intent(<span class="keyword">this</span>,MyService.class);
<span class="comment">//启动服务</span>
startService(serviceIntent);
<span class="comment">//绑定服务,需要先定义ServiceConnection</span>
ServiceConnection connection = <span class="keyword">new</span> ServiceConnection() {
    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceConnected</span><span class="params">(ComponentName name, IBinder service)</span> </span>{
        <span class="comment">//start task</span>
    }

    <span class="annotation">@Override</span>
    <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">onServiceDisconnected</span><span class="params">(ComponentName name)</span> </span>{

    }
   };
<span class="comment">//第三个参数为标志位,BIND_AUTO_CREATE表示绑定时自动创建Service(调用onCreate方法)</span>
   bindService(serviceIntent,connection,BIND_AUTO_CREATE);
</code></pre></li>
</ul>
<pre><code>还需在AndroidManifest.xml的&lt;<span class="type">application</span>&gt;标签中添加以下代码:

    &lt;service android:enabled=<span class="string">"true"</span>
         android:<span class="property">name</span>=<span class="string">".MyService"</span>/&gt;
</code></pre><ul>
<li><p>可以通过以下代码销毁服务。</p>
<pre><code><span class="comment">//销毁服务</span>
stopService<span class="params">(serviceIntent)</span>;
<span class="comment">//解绑服务</span>
unbindService<span class="params">(serviceIntent)</span>;
</code></pre></li>
</ul>
<p>注意只有当一个Service没有与任何组件关联并停止时，该Service才会被销毁。即如果既调用了startService又调用了bindService,则要同时调用stopService和unbindService才能销毁服务。</p>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
      

  <div class="post post-type-normal ">
    <div class="post-header">

      
      
        <h1 class="post-title">
          
          
            
              <a class="post-title-link" href="/2015/01/05/Content-Provider介绍/">
                Content Provider介绍
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于 2015 Jan 5
        </span>

        
          <span class="post-category">
            &nbsp; | &nbsp; 分类于
            
              <a href="/categories/Android/">Android</a>

              
              

            
          </span>
        

        
          
            <span class="post-comments-count">
            &nbsp; | &nbsp;
            <a href="/2015/01/05/Content-Provider介绍/#comments" >
              <span class="post-comments-count ds-thread-count" data-thread-key="2015/01/05/Content-Provider介绍/"></span>
            </a>
          </span>
          
        
      </div>
    </div>

    <div class="post-body">

      
      

      
        
          <p>Content Provider顾名思义，表示内容提供者，提供了对外部数据进行增、删、查、改的功能。</p>
<ol>
<li>通过Context.getContentResolver获取ContentResolver对象，并通过ContentResolver.insert、ContentResolver.delete、ContentResolver.query、ContentResolver.update进行操作。</li>
<li>通过设置<user-permission>可以对特定的内容设置相应的读写权限。</user-permission></li>
<li><p>不需要打开应用即可通过Content Provider对象访问应用的数据。</p>
<h4 id="方法原型：">方法原型：</h4><p> public Cursor query(Uri uri, String[] projection,</p>
<pre><code><span class="keyword">String </span><span class="keyword">selection, </span><span class="keyword">String[] </span><span class="keyword">selectionArgs, </span><span class="keyword">String </span>sortOrder)<span class="comment">;</span>
</code></pre></li>
</ol>
<ul>
<li>uri表示Content Provider的Uri，必须以”content://“开头。</li>
<li>projection表示所查询的字段，即SQL中select和from的中间部分,传null时表示查询全部。</li>
<li>selection表示查询条件，即SQL中where后的部分。</li>
<li>selectionArgs表示查询条件的参数值。</li>
<li>sortOrder表示需要排序的字段，即SQL中order by的部分。</li>
</ul>
<p>eg:</p>
<pre><code>contentProvider.query(<span class="built_in">Uri</span>.parse(<span class="string">"content://sms/inbox"</span>),<span class="keyword">null</span>,
                        <span class="string">"address like ?"</span>,<span class="keyword">new</span> <span class="built_in">String</span>[]{<span class="string">"1%"</span>},<span class="keyword">null</span>);
</code></pre><p>表示从收到的短信中查询所有1开头的电话号码所发送的短信。</p>
<ul>
<li><p>插入方法：</p>
<pre><code>public Uri <span class="operator"><span class="keyword">insert</span>(Uri uri, ContentValues <span class="keyword">values</span>);</span>
</code></pre></li>
<li><p>删除方法：</p>
<pre><code>public <span class="built_in">int</span> delete(<span class="built_in">Uri</span> uri, <span class="built_in">String</span> selection, <span class="built_in">String</span>[] selectionArgs);
</code></pre></li>
<li><p>修改方法：</p>
<pre><code>public int <span class="operator"><span class="keyword">update</span>(Uri uri, ContentValues <span class="keyword">values</span>, <span class="keyword">String</span> selection,
    <span class="keyword">String</span>[] selectionArgs);</span>
</code></pre></li>
</ul>
<h4 id="如果希望自定义Content_Provider，需要注意：">如果希望自定义Content Provider，需要注意：</h4><ol>
<li>定义Content Provider的URI，URI包括authority和path两部分，完整的URI可以表示分content://authority/path</li>
<li><p>通过UriMatcher映射Uri与返回代码，eg：</p>
<pre><code>String AUTHORITY = <span class="string">"mobile.android.myprovider"</span>;
<span class="keyword">int</span> <span class="built_in">CITIES</span> = <span class="number">1</span>;
<span class="keyword">int</span> <span class="built_in">CITY_CODE</span> = <span class="number">2</span>;

<span class="comment">//开始映射</span>
UriMatcher uriMatcher = new UriMatcher(UriMatcher<span class="variable">.NO_MATCH</span>);
uriMatcher<span class="variable">.addURI</span>(AUTHORITY,<span class="string">"cities"</span>,<span class="built_in">CITIES</span>);
uriMatcher<span class="variable">.addURI</span>(AUTHORITY,<span class="string">"code/#"</span>,<span class="built_in">CITY_CODE</span>);
</code></pre></li>
<li><p>根据对增、删、查、改功能的需求实现相应的insert、delete、query、update方法，如果不需要的话可以使相应的方法直接返回null。</p>
<pre><code><span class="comment">//解析Uri</span>
<span class="keyword">switch</span>(uriMatcher.match(uri)){
    <span class="keyword">case</span> <span class="string">CITIES:</span>
            <span class="comment">//</span>
    <span class="keyword">case</span> <span class="string">CITY_CODE:</span>
            <span class="comment">//code为uri中content://authority/code/后的内容</span>
            <span class="typename">int</span> code = uri.getPathSegments().get(<span class="number">1</span>);
}
</code></pre></li>
</ol>

        
      
    </div>

    <div class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </div>
  </div>


    
  </div>

  
  <div class="pagination">
    <a class="extend prev" rel="prev" href="/page/5/">&laquo;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><span class="page-number current">6</span><a class="page-number" href="/page/7/">7</a><span class="space">&hellip;</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/7/">&raquo;</a>
  </div>


        </div>

        
      </div>


      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <div id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <div class="site-overview">
        <div class="site-author motion-element">
          <img class="site-author-image" src="/images/default_avatar.jpg" alt="Jianqiu" />
          <p class="site-author-name">Jianqiu</p>
        </div>
        <p class="site-description motion-element">Android | jianqiu's blog</p>
        <div class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">45</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">5</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">40</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </div>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>
        
      </div>

      

    </div>
  </div>


    </div>

    <div id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; &nbsp; 
  2015
  <span class="with-love">
    <i class="icon-heart"></i>
  </span>
  <span class="author">Jianqiu</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>



      </div>
    </div>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.3"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.3"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.3" id="motion.global"></script>



  <script type="text/javascript" src="/js/search-toggle.js"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
    });
  </script>

  

  
  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"niorgai"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  


  
  

  
  <!-- lazyload -->
  <script type="text/javascript" src="/js/lazyload.js"></script>
      <script type="text/javascript">
        jQuery(function() {          
            jQuery("#posts img").lazyload({
              placeholder:"http://www.arao.me/loading.gif",  
                effect:"fadeIn"
              });
            });
    </script>   
</body>
</html>

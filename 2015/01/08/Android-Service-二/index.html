<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Android Service (二) | Jianqiu&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="后台服务在第一篇的Service介绍中说到Service的启动是后台运行,其实这里的后台跟Thread完全没有关系，这里所说的Service后台只是表示它不依赖UI，但事实上他与所绑定的组件是在同一个进程中运行的！所以如果Service中执行了耗时操作，一样会提示ANR。
如果Service与Activity绑定，即使Activity被销毁，或者程序被kill，Service还是会继续运行。当程序">
<meta property="og:type" content="article">
<meta property="og:title" content="Android Service (二)">
<meta property="og:url" content="http://yoursite.com/2015/01/08/Android-Service-二/index.html">
<meta property="og:site_name" content="Jianqiu's blog">
<meta property="og:description" content="后台服务在第一篇的Service介绍中说到Service的启动是后台运行,其实这里的后台跟Thread完全没有关系，这里所说的Service后台只是表示它不依赖UI，但事实上他与所绑定的组件是在同一个进程中运行的！所以如果Service中执行了耗时操作，一样会提示ANR。
如果Service与Activity绑定，即使Activity被销毁，或者程序被kill，Service还是会继续运行。当程序">
<meta property="og:updated_time" content="2015-01-10T04:38:45.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Android Service (二)">
<meta name="twitter:description" content="后台服务在第一篇的Service介绍中说到Service的启动是后台运行,其实这里的后台跟Thread完全没有关系，这里所说的Service后台只是表示它不依赖UI，但事实上他与所绑定的组件是在同一个进程中运行的！所以如果Service中执行了耗时操作，一样会提示ANR。
如果Service与Activity绑定，即使Activity被销毁，或者程序被kill，Service还是会继续运行。当程序">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Jianqiu&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Learn More</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">首页</a>
        
          <a class="main-nav-link" href="/archives">文档</a>
        
      </nav>
      <nav id="sub-nav">
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-Android-Service-二" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2015/01/08/Android-Service-二/" class="article-date">
  <time datetime="2015-01-08T06:08:42.000Z" itemprop="datePublished">2015 1月 8</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/Android/">Android</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Android Service (二)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="后台服务">后台服务</h4><p>在<a href="http://niorgai.github.io/2015/01/06/Android-Service-%E4%B8%80/" target="_blank" rel="external">第一篇的Service介绍</a>中说到Service的启动是后台运行,其实这里的后台跟Thread完全没有关系，这里所说的Service后台只是表示它不依赖UI，但事实上他与所绑定的组件是在<strong>同一个进程中</strong>运行的！所以如果Service中执行了耗时操作，一样会提示ANR。</p>
<p>如果Service与Activity绑定，即使Activity被销毁，或者程序被kill，Service还是会继续运行。当程序重新运行或者Activity重新与Service绑定后，可以获取Service中Binder的实例并调用其任意的公有方法。</p>
<h6 id="如果希望在Service中执行耗时操作，只需要在Service中新建一个子线程，如下图：">如果希望在Service中执行耗时操作，只需要在Service中新建一个子线程，如下图：</h6><pre><code><span class="annotation">@Override</span>
<span class="keyword">public</span> <span class="function"><span class="keyword">int</span> <span class="title">onStartCommand</span><span class="params">(Intent intent, <span class="keyword">int</span> flags, <span class="keyword">int</span> startId)</span> </span>{
    <span class="keyword">new</span> Thread(<span class="keyword">new</span> Runnable() {
        <span class="annotation">@Override</span>
        <span class="keyword">public</span> <span class="function"><span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>{
            <span class="comment">// 开始执行后台任务</span>
        }
    }).start();
    <span class="function"><span class="keyword">return</span> <span class="keyword">super</span>.<span class="title">onStartCommand</span><span class="params">(intent, flags, startId)</span></span>;
}
</code></pre><h6 id="IntentService:方便用于执行耗时操作的Service子类">IntentService:方便用于执行耗时操作的Service子类</h6><p>文档原文：This is a subclass of Service that uses a worker thread to handle all start requests, one at a time. This is the best option if you don’t require that your service handle multiple requests simultaneously. All you need to do is implement onHandleIntent(), which receives the intent for each start request so you can do the background work.</p>
<p>当Service不需要同时处理多个请求时，使用IntentService会很方便。IntentService会默认开启一个worker thread来处理startService的请求，因为已经默认开了一个thread了，所以可以在Service中直接处理耗时操作。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">myService</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">IntentService</span>{</span>

        <span class="annotation">@Override</span>
        <span class="keyword">protected</span> void onHandleIntent(<span class="type">Intent</span> intent) {

        }
    }
</code></pre><hr>
<h4 id="前台服务">前台服务</h4><p>Service的系统优先级是比较低的，当系统内存不足时可能回收后台运行的Service，如果希望自己的Servie不被回收，可以使用前台Service，同时前台Service也会显示在系统的状态栏，下拉可以看到相关状态。</p>
<pre><code><span class="class"><span class="keyword">class</span> <span class="title">MyService</span> <span class="keyword"><span class="keyword">extends</span></span> <span class="title">Service</span>{</span>

        <span class="annotation">@Override</span>
        public void onCreate() {
            <span class="type">Notification</span> notification = <span class="keyword">new</span> <span class="type">Notification</span>(
                    <span class="type">R</span>.drawable.ic_launcher,<span class="string">"有通知"</span>,<span class="type">System</span>.currentTimeMillis());
            <span class="comment">//设置目标Intent</span>
            <span class="type">Intent</span> notifyIntent = <span class="keyword">new</span> <span class="type">Intent</span>(<span class="keyword">this</span>,<span class="type">MainActivity</span>.<span class="keyword">class</span>);
            <span class="comment">//设置点击跳转Intent</span>
            <span class="type">PendingIntent</span> pendingIntent = <span class="type">PendingIntent</span>.getActivity(
                    <span class="keyword">this</span>,<span class="number">0</span>,notifyIntent,<span class="number">0</span>);
            notification.setLatestEventInfo(<span class="keyword">this</span>,<span class="string">"通知的标题"</span>,<span class="string">"通知的内容"</span>,pendingIntent);
            startForeground(<span class="number">0</span>,notification);
            <span class="comment">//</span>
            <span class="keyword">super</span>.onCreate();
        }
    }
</code></pre><p> 其实就是创建一个Notification,通过setLatestEventInfo方法设置内容，startForeground方法变将其变为一个前台Service。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2015/01/08/Android-Service-二/" data-id="cib3rnex70055du8swux9oulp" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Service/">Service</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/四大组件/">四大组件</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2015/01/10/Broadcast-Receiver使用/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Broadcast Receiver使用
        
      </div>
    </a>
  
  
    <a href="/2015/01/06/Android-Service-一/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Android Service (一)</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
   <!-- 多说评论框 start -->
    <div class="ds-thread" data-thread-key="post-Android-Service-二" data-title="Android Service (二)" data-url="http://yoursite.com/2015/01/08/Android-Service-二/"></div>
    <!-- 多说评论框 end -->
    <!-- 多说公共JS代码 start (一个网页只需插入一次) -->
    <script type="text/javascript">
    var duoshuoQuery = {short_name:'niorgai'};
      (function() {
        var ds = document.createElement('script');
        ds.type = 'text/javascript';ds.async = true;
        ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
        ds.charset = 'UTF-8';
        (document.getElementsByTagName('head')[0] 
         || document.getElementsByTagName('body')[0]).appendChild(ds);
      })();
      </script>
    <!-- 多说公共JS代码 end -->
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a><span class="category-list-count">42</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Android开发tips/">Android开发tips</a><span class="category-list-count">5</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Java/">Java</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/方便开发/">方便开发</a><span class="category-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Activity/">Activity</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Android/">Android</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/AsyncTask/">AsyncTask</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/BaseAdapter/">BaseAdapter</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Bitmap/">Bitmap</a><span class="tag-list-count">5</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Broadcast-Receiver/">Broadcast Receiver</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Content-Provider/">Content Provider</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/EditText/">EditText</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Git/">Git</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Gradle/">Gradle</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Handler/">Handler</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ListView/">ListView</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenFileInput/">OpenFileInput</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/OpenFileOutput/">OpenFileOutput</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/PopupWindow/">PopupWindow</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/SQL/">SQL</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ScrollView/">ScrollView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Service/">Service</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/TextView/">TextView</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/UI线程/">UI线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/shape/">shape</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/sharedPreference/">sharedPreference</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/代码混淆/">代码混淆</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/优化性能/">优化性能</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/内存泄漏/">内存泄漏</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/反编译/">反编译</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/四大组件/">四大组件</a><span class="tag-list-count">6</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/壁纸设置/">壁纸设置</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/多线程/">多线程</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/对象引用/">对象引用</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/屏幕单位/">屏幕单位</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/序列化/">序列化</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/手柄支持/">手柄支持</a><span class="tag-list-count">4</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/数据存储/">数据存储</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/文件存储/">文件存储</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/版本控制/">版本控制</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/获取图片/">获取图片</a><span class="tag-list-count">3</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/05/">五月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/04/">四月 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/03/">三月 2015</a><span class="archive-list-count">9</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/02/">二月 2015</a><span class="archive-list-count">10</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/01/">一月 2015</a><span class="archive-list-count">14</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2014/12/">十二月 2014</a><span class="archive-list-count">18</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2015/05/13/ProgressBar相关/">ProgressBar相关</a>
          </li>
        
          <li>
            <a href="/2015/04/24/ListView的一些坑/">ListView的一些坑</a>
          </li>
        
          <li>
            <a href="/2015/03/23/Android文件存储/">Android文件存储</a>
          </li>
        
          <li>
            <a href="/2015/03/19/Handler原理浅析/">Handler原理浅析</a>
          </li>
        
          <li>
            <a href="/2015/03/19/Android-Studio开发遇到的问题/">Android Studio开发遇到的问题</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2015 Jianqiu<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">首页</a>
  
    <a href="/archives" class="mobile-nav-link">文档</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>



<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>